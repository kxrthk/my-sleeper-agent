name: Hourly Sentinel

on:
  schedule:
    # Runs at minute 15 past every hour from 4 through 10 UTC
    # (9:15 AM to 3:15 PM India Time)
    - cron: '15 4-10 * * 1-5'
  workflow_dispatch: # Allows manual run

permissions:
  contents: write # CRITICAL: Allows bot to save memory

jobs:
  run-sentinel:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Install Dependencies
        # We install from your requirements.txt
        run: pip install -r requirements.txt
        
      - name: Run Sentinel Bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        # Make sure this matches your actual python filename (e.g., daily_bot.py)
        run: python daily_bot.py
        
      - name: Save Memory (Commit changes)
        run: |
          git config --global user.name "Sleeper Agent"
          git config --global user.email "agent@sentinel.com"
          # We add the Journal AND the new Brain file
          git add trading_journal.csv bot_brain.json
          # We only commit if there are changes (avoids errors if no trades happened)
          git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸ§  Agent Learning Update" && git push)
